(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[168],{1927:function(e,t,a){Promise.resolve().then(a.bind(a,5476))},5476:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var n=a(7437),s=a(2265),r=a(1180),l=a(495),i=a(7440);let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)("div",{className:"relative w-full overflow-auto",children:(0,n.jsx)("table",{ref:t,className:(0,i.cn)("w-full caption-bottom text-sm",a),...s})})});o.displayName="Table";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)("thead",{ref:t,className:(0,i.cn)(a),...s})});c.displayName="TableHeader";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)("tbody",{ref:t,className:(0,i.cn)("[&_tr:last-child]:border-0",a),...s})});d.displayName="TableBody",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)("tfoot",{ref:t,className:(0,i.cn)("border-t border-border bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...s})}).displayName="TableFooter";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)("tr",{ref:t,className:(0,i.cn)("border-b border-border transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...s})});u.displayName="TableRow";let m=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)("th",{ref:t,className:(0,i.cn)("h-12 px-3 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:w-px [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-0.5",a),...s})});m.displayName="TableHead";let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)("td",{ref:t,className:(0,i.cn)("p-3 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-0.5",a),...s})});f.displayName="TableCell",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)("caption",{ref:t,className:(0,i.cn)("mt-4 text-sm text-muted-foreground",a),...s})}).displayName="TableCaption";var h=a(837),x=a(357);function p(){var e,t,a;let[i,p]=(0,s.useState)([]),[N,g]=(0,s.useState)(!0),[v,j]=(0,s.useState)(null),[b,y]=(0,s.useState)(null),[I,_]=(0,s.useState)(!1),[w,C]=(0,s.useState)(!1),[S,T]=(0,s.useState)(null),[k,E]=(0,s.useState)(""),[A,U]=(0,s.useState)(""),[L,z]=(0,s.useState)("active"),B=null!==(e=x.env.NEXT_PUBLIC_SUPABASE_URL)&&void 0!==e?e:"https://potpgjiuqimpbrhdafnz.supabase.co",R=null!==(t=x.env.NEXT_PUBLIC_MERCHANT_LIST_URL)&&void 0!==t?t:"".concat(B.replace(/\/$/,""),"/functions/v1/get-merchant-list"),J=null!==(a=x.env.NEXT_PUBLIC_MERCHANT_MANAGE_URL)&&void 0!==a?a:R,O=(0,s.useMemo)(()=>async()=>{let e=localStorage.getItem("tpx_access_token");if(!e){window.location.assign("/login");return}if(!R){j("缺少 NEXT_PUBLIC_MERCHANT_LIST_URL"),g(!1);return}try{var t;(0,r.N)();let a=null!==(t=x.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)&&void 0!==t?t:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBvdHBnaml1cWltcGJyaGRhZm56Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5Nzc0NTgsImV4cCI6MjA3NDU1MzQ1OH0.s-m9tLoZj9nqf81k-fG5AtN-DDKWTUCyTULkAL4POjI",n=await fetch(R,{method:"GET",headers:{Authorization:"Bearer ".concat(e),apikey:null!=a?a:"","Content-Type":"application/json"}});if(!n.ok){let e=await n.text();throw Error(e||"请求失败，状态码 ".concat(n.status))}let s=await n.json();if(!s.success)throw Error("接口返回失败。");p(s.merchants||[])}catch(e){j((null==e?void 0:e.message)||"加载失败")}finally{g(!1)}},[R]);async function P(e){try{await navigator.clipboard.writeText(e),y(e),setTimeout(()=>y(null),1500)}catch(a){let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){}document.body.removeChild(t),y(e),setTimeout(()=>y(null),1500)}}async function M(){try{let e=(0,r.N)();await e.auth.signOut()}finally{localStorage.removeItem("tpx_access_token"),window.location.assign("/login")}}async function X(e){var t;if(e.preventDefault(),T(null),!k.trim()){T("请输入商户名称");return}if(!A.trim()){T("请输入域名");return}let a=localStorage.getItem("tpx_access_token");if(!a){window.location.assign("/login");return}let n=null!==(t=x.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)&&void 0!==t?t:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBvdHBnaml1cWltcGJyaGRhZm56Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5Nzc0NTgsImV4cCI6MjA3NDU1MzQ1OH0.s-m9tLoZj9nqf81k-fG5AtN-DDKWTUCyTULkAL4POjI";C(!0);try{let e=await fetch(J,{method:"POST",headers:{Authorization:"Bearer ".concat(a),apikey:n,"Content-Type":"application/json"},body:JSON.stringify({merchant_name:k.trim(),domain:A.trim(),status:L})}),t=await e.json().catch(()=>({}));if(!e.ok||!(null==t?void 0:t.success)){T((null==t?void 0:t.message)||"创建失败（".concat(e.status,"）。请稍后重试"));return}T("创建成功"),E(""),U(""),z("active"),_(!1),g(!0),await O()}catch(e){T((null==e?void 0:e.message)||"网络错误")}finally{C(!1)}}return(0,s.useEffect)(()=>{O()},[O]),(0,n.jsxs)("div",{className:"max-w-5xl mx-auto p-6",children:[(0,n.jsxs)("div",{className:"mb-4 flex items-center justify-between gap-3",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:"Merchants"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(l.z,{onClick:()=>_(!0),children:"Create New"}),(0,n.jsx)(l.z,{variant:"outline",onClick:M,children:"Logout"})]})]}),N&&(0,n.jsx)("p",{children:"Loading..."}),v&&(0,n.jsx)("p",{className:"text-red-600",children:v}),!N&&!v&&(0,n.jsx)("div",{className:"rounded-md border",children:(0,n.jsxs)(o,{children:[(0,n.jsx)(c,{children:(0,n.jsxs)(u,{children:[(0,n.jsx)(m,{children:"Merchant ID"}),(0,n.jsx)(m,{children:"Name"}),(0,n.jsx)(m,{children:"Domain"}),(0,n.jsx)(m,{children:"Status"}),(0,n.jsx)(m,{children:"Created At"})]})}),(0,n.jsxs)(d,{children:[i.map(e=>(0,n.jsxs)(u,{children:[(0,n.jsxs)(f,{className:"font-mono text-sm",children:[(0,n.jsx)("button",{type:"button",onClick:()=>P(e.merchant_id),title:"点击复制",className:"underline decoration-dotted underline-offset-4 hover:no-underline focus:outline-none",children:e.merchant_id}),b===e.merchant_id&&(0,n.jsx)("span",{className:"ml-2 text-xs text-green-600 align-middle",children:"已复制"})]}),(0,n.jsx)(f,{children:e.merchant_name}),(0,n.jsx)(f,{children:e.domain||"-"}),(0,n.jsx)(f,{children:e.status}),(0,n.jsx)(f,{children:new Date(e.created_at).toLocaleString()})]},e.merchant_id)),0===i.length&&(0,n.jsx)(u,{children:(0,n.jsx)(f,{colSpan:4,className:"text-center text-muted-foreground",children:"暂无数据"})})]})]})}),(0,n.jsx)(h.Vq,{open:I,onOpenChange:_,children:(0,n.jsxs)(h.cZ,{className:"sm:max-w-md",children:[(0,n.jsxs)(h.fK,{children:[(0,n.jsx)(h.$N,{children:"Create Merchant"}),(0,n.jsx)(h.Be,{children:"新增商户信息。"})]}),(0,n.jsxs)("form",{onSubmit:X,className:"space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{htmlFor:"merchant_name",className:"text-sm font-medium",children:"Merchant Name"}),(0,n.jsx)("input",{id:"merchant_name",className:"w-full border rounded px-3 py-2",value:k,onChange:e=>E(e.target.value),required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{htmlFor:"domain",className:"text-sm font-medium",children:"Domain"}),(0,n.jsx)("input",{id:"domain",className:"w-full border rounded px-3 py-2",value:A,onChange:e=>U(e.target.value),required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{htmlFor:"status",className:"text-sm font-medium",children:"Status"}),(0,n.jsxs)("select",{id:"status",className:"w-full border rounded px-3 py-2",value:L,onChange:e=>z(e.target.value),children:[(0,n.jsx)("option",{value:"active",children:"active"}),(0,n.jsx)("option",{value:"inactive",children:"inactive"})]})]}),S&&(0,n.jsx)("p",{className:"text-sm text-red-600",children:S}),(0,n.jsxs)(h.cN,{children:[(0,n.jsx)(l.z,{type:"button",variant:"outline",onClick:()=>_(!1),children:"Cancel"}),(0,n.jsx)(l.z,{type:"submit",disabled:w,children:w?"Creating...":"Create"})]})]})]})})]})}},495:function(e,t,a){"use strict";a.d(t,{z:function(){return c}});var n=a(7437),s=a(2265),r=a(1538),l=a(3027),i=a(7440);let o=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:a,variant:s,size:l,asChild:c=!1,...d}=e,u=c?r.g7:"button";return(0,n.jsx)(u,{className:(0,i.cn)(o({variant:s,size:l,className:a})),ref:t,...d})});c.displayName="Button"},837:function(e,t,a){"use strict";a.d(t,{$N:function(){return h},Be:function(){return x},Vq:function(){return o},cN:function(){return f},cZ:function(){return u},fK:function(){return m}});var n=a(7437),s=a(2265),r=a(2794),l=a(4697),i=a(7440);let o=r.fC;r.xz;let c=r.h_;r.x8;let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});d.displayName=r.aV.displayName;let u=s.forwardRef((e,t)=>{let{className:a,children:s,...o}=e;return(0,n.jsxs)(c,{children:[(0,n.jsx)(d,{}),(0,n.jsxs)(r.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o,children:[s,(0,n.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(l.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=r.VY.displayName;let m=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};m.displayName="DialogHeader";let f=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};f.displayName="DialogFooter";let h=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});h.displayName=r.Dx.displayName;let x=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...s})});x.displayName=r.dk.displayName},1180:function(e,t,a){"use strict";a.d(t,{N:function(){return r}});var n=a(2835),s=a(357);function r(){var e,t;let a=null!==(e=s.env.NEXT_PUBLIC_SUPABASE_URL)&&void 0!==e?e:"https://potpgjiuqimpbrhdafnz.supabase.co",r=null!==(t=s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)&&void 0!==t?t:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBvdHBnaml1cWltcGJyaGRhZm56Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5Nzc0NTgsImV4cCI6MjA3NDU1MzQ1OH0.s-m9tLoZj9nqf81k-fG5AtN-DDKWTUCyTULkAL4POjI";if(!a||!r)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY");return(0,n.eI)(a,r)}},7440:function(e,t,a){"use strict";a.d(t,{cn:function(){return r}});var n=a(4839),s=a(6164);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,n.W)(t))}}},function(e){e.O(0,[502,584,835,971,23,744],function(){return e(e.s=1927)}),_N_E=e.O()}]);